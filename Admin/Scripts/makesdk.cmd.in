@echo off

setlocal

set sdkname=miktex-sdk-@MIKTEX_SERIES_STR@.@MIKTEX_J2000_VERSION@
set sdkdir=C:\MiKTeX-SDKs\%sdkname%

set excl=@CMAKE_BINARY_DIR_NATIVE@\excl

if exist "%sdkdir%" rmdir /s /q "%sdkdir%"
mkdir "%sdkdir%"
mkdir "%sdkdir%\include\miktex"
echo ~>%excl%
echo .svn>>%excl%
echo .h.in>>%excl%
echo .vcproj.in>>%excl%
echo CMakeLists.txt>>%excl%

pushd "@CMAKE_SOURCE_DIR_NATIVE@"
xcopy /EXCLUDE:%excl% /S SDK "%sdkdir%"
popd

pushd "@CMAKE_BINARY_DIR_NATIVE@\Libraries\MiKTeX"
copy Core\include\miktexidl.h "%sdkdir%\include"
copy Core\include\sessionidl.h "%sdkdir%\include"
copy Core\session.tlb "%sdkdir%\include"
copy PackageManager\include\mpmidl.h "%sdkdir%\include"
popd

pushd "@CMAKE_BINARY_DIR_NATIVE@"
xcopy /EXCLUDE:%excl% /S SDK "%sdkdir%"
popd

del "%excl%"

pushd "%sdkdir%"
cd ..
zip -9r %sdkname%.zip %sdkname%
popd

endlocal
